////////////////////////////////////////////////
// File:	APIHandler.h
//
// Author:	Liam Russell (A.K.A. BitSlapper)
//
// Copyright:	2014-2015 Liam Russell
//
// License:	GNU GENERAL PUBLIC LICENSE V3
//////////////////////////////////////////////

#ifndef _APIHANDLER_H_
#define _APIHANDLER_H_

#include <string>
#include <algorithm>
#include <deque>
#include <set>
#include <map>
#include <boost/lexical_cast.hpp>
#include <boost/bind.hpp>

#include <json_spirit.h>

typedef std::deque<std::string> MessageQueue;

class Application;

class APIHandler
{
private:

	Application* m_pApp;

	MessageQueue m_mqRecentMessages;

	void ProcessRequest(const std::string& szQuery, const std::map<std::string, std::string>& mapParams, json_spirit::Object& pObject);

	void GetMiningInfo(json_spirit::Object& pObject);

public:

	//////////////////////////////////////////////////////////////////////////////
	//Constructor
	///////////////////////////////////////////////////////////////////////////////
	APIHandler();

	///////////////////////////////////////////////////////////////////////////////
	//Copy Constructor
	///////////////////////////////////////////////////////////////////////////////
	APIHandler(const APIHandler& apiHandler);

	///////////////////////////////////////////////////////////////////////////////
	//Assignment Operator
	///////////////////////////////////////////////////////////////////////////////
	APIHandler& operator=(const APIHandler& apiHandler);

	///////////////////////////////////////////////////////////////////////////////
	//Destructor
	///////////////////////////////////////////////////////////////////////////////
	~APIHandler();

	///////////////////////////////////////////////////////////////////////////////
	//Accessors
	///////////////////////////////////////////////////////////////////////////////
	const MessageQueue& GetMessageQueue() const { return this->m_mqRecentMessages; }

	std::string HandleRequest(const std::string& szQuery, const std::map<std::string, std::string>& mapParams);
};


#endif //_APIHANDLER_H_